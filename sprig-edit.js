/*
@title: Sprig-Edit
@author: Colack
@tags: ['utility']
@img: ""
@addedOn: 2024-04-30

This is a simple text editor for Sprig.

Controls:
AD - Left / Right
JL - Change Letter
W - New Line
S - Space and Start
I - Place
K - Delete
*/

// NOTE: There are 40 characters in the game.

const MUSIC_main = tune`
97.71986970684038: C4-97.71986970684038 + C5/97.71986970684038,
97.71986970684038,
97.71986970684038: C4-97.71986970684038 + C5/97.71986970684038,
97.71986970684038,
97.71986970684038: C4-97.71986970684038,
97.71986970684038: E4-97.71986970684038 + E5/97.71986970684038,
97.71986970684038: C4-97.71986970684038 + C5/97.71986970684038,
97.71986970684038,
97.71986970684038: C4-97.71986970684038 + C5/97.71986970684038,
97.71986970684038,
97.71986970684038: C4-97.71986970684038 + C5/97.71986970684038,
97.71986970684038: E4-97.71986970684038 + E5/97.71986970684038,
97.71986970684038: C4-97.71986970684038 + C5/97.71986970684038,
97.71986970684038,
97.71986970684038: C4-97.71986970684038 + C5/97.71986970684038,
97.71986970684038,
97.71986970684038: C4-97.71986970684038 + C5/97.71986970684038,
97.71986970684038: C4-97.71986970684038 + C5/97.71986970684038,
97.71986970684038: G4-97.71986970684038 + G5/97.71986970684038,
97.71986970684038,
97.71986970684038: G4-97.71986970684038 + G5/97.71986970684038,
97.71986970684038,
97.71986970684038: B4-97.71986970684038 + B5/97.71986970684038,
97.71986970684038,
97.71986970684038: G4-97.71986970684038 + G5/97.71986970684038,
97.71986970684038,
97.71986970684038: B4-97.71986970684038 + B5/97.71986970684038,
97.71986970684038: A4-97.71986970684038 + A5/97.71986970684038,
97.71986970684038: G4-97.71986970684038 + G5/97.71986970684038,
97.71986970684038: F4-97.71986970684038 + F5/97.71986970684038,
97.71986970684038: E4-97.71986970684038 + E5/97.71986970684038,
97.71986970684038: D4-97.71986970684038 + D5/97.71986970684038`;
const MUSIC_controls = tune`
138.88888888888889: C4/138.88888888888889 + C5^138.88888888888889,
138.88888888888889,
138.88888888888889: C4/138.88888888888889 + C5^138.88888888888889,
138.88888888888889: D4/138.88888888888889 + D5^138.88888888888889,
138.88888888888889: G4/138.88888888888889 + G5^138.88888888888889,
138.88888888888889,
138.88888888888889: G4/138.88888888888889 + G5^138.88888888888889,
138.88888888888889: B4/138.88888888888889 + B5^138.88888888888889,
138.88888888888889: G4/138.88888888888889 + G5^138.88888888888889,
138.88888888888889: D4/138.88888888888889 + D5^138.88888888888889,
138.88888888888889: D4/138.88888888888889 + D5^138.88888888888889,
138.88888888888889: G4/138.88888888888889 + G5^138.88888888888889,
138.88888888888889,
138.88888888888889: G4/138.88888888888889 + G5^138.88888888888889,
138.88888888888889: C5^138.88888888888889 + C4/138.88888888888889,
138.88888888888889: E5^138.88888888888889 + E4/138.88888888888889,
138.88888888888889: C5^138.88888888888889 + C4/138.88888888888889,
138.88888888888889: E5^138.88888888888889 + E4/138.88888888888889,
138.88888888888889: E5^138.88888888888889 + E4/138.88888888888889,
138.88888888888889: G5^138.88888888888889 + G4/138.88888888888889,
138.88888888888889: E5^138.88888888888889 + E4/138.88888888888889,
138.88888888888889: G5^138.88888888888889 + G4/138.88888888888889,
138.88888888888889: G5^138.88888888888889 + G4/138.88888888888889,
138.88888888888889: B5^138.88888888888889 + B4/138.88888888888889,
138.88888888888889: G5^138.88888888888889 + G4/138.88888888888889,
138.88888888888889: B5^138.88888888888889 + B4/138.88888888888889,
138.88888888888889: G5^138.88888888888889 + G4/138.88888888888889,
138.88888888888889: E5^138.88888888888889 + E4/138.88888888888889,
138.88888888888889: C5^138.88888888888889 + C4/138.88888888888889,
138.88888888888889: E5^138.88888888888889 + E4/138.88888888888889,
138.88888888888889: G5^138.88888888888889 + G4/138.88888888888889,
138.88888888888889: E5^138.88888888888889 + E4/138.88888888888889`;
const MUSIC_editor = tune`
196.07843137254903: C4/196.07843137254903 + C5-196.07843137254903,
196.07843137254903: D4/196.07843137254903 + F5-196.07843137254903,
196.07843137254903: C4/196.07843137254903 + A5-196.07843137254903,
196.07843137254903: D4/196.07843137254903,
196.07843137254903: G4/196.07843137254903 + A5-196.07843137254903,
196.07843137254903: A4/196.07843137254903 + F5-196.07843137254903,
196.07843137254903: G4/196.07843137254903,
196.07843137254903: A4/196.07843137254903 + F5-196.07843137254903,
196.07843137254903: C4/196.07843137254903 + D5-196.07843137254903,
196.07843137254903: D4/196.07843137254903 + C5-196.07843137254903,
196.07843137254903: C4/196.07843137254903 + C5-196.07843137254903,
196.07843137254903: D4/196.07843137254903 + D5-196.07843137254903,
196.07843137254903: G4/196.07843137254903 + D5-196.07843137254903,
196.07843137254903: A4/196.07843137254903 + F5-196.07843137254903,
196.07843137254903: G4/196.07843137254903 + C5-196.07843137254903,
196.07843137254903: A4/196.07843137254903 + F5-196.07843137254903,
196.07843137254903: C4/196.07843137254903 + D5-196.07843137254903,
196.07843137254903: D4/196.07843137254903 + F5-196.07843137254903,
196.07843137254903: C4/196.07843137254903 + A5-196.07843137254903,
196.07843137254903: D4/196.07843137254903 + F5-196.07843137254903,
196.07843137254903: G4/196.07843137254903,
196.07843137254903: A4/196.07843137254903 + F5-196.07843137254903,
196.07843137254903: G4/196.07843137254903 + E5-196.07843137254903,
196.07843137254903: A4/196.07843137254903 + C5-196.07843137254903,
196.07843137254903: C4/196.07843137254903 + E5-196.07843137254903,
196.07843137254903: D4/196.07843137254903 + A5-196.07843137254903,
196.07843137254903: C4/196.07843137254903 + D5-196.07843137254903,
196.07843137254903: D4/196.07843137254903 + F5-196.07843137254903,
196.07843137254903: G4/196.07843137254903 + D5-196.07843137254903,
196.07843137254903: A4/196.07843137254903 + F5-196.07843137254903,
196.07843137254903: G4/196.07843137254903 + D5-196.07843137254903,
196.07843137254903: A4/196.07843137254903 + C5-196.07843137254903`;

const SFX_start = tune`
500: C4-500,
15500`;
const SFX_edit = tune`
103.44827586206897: C4-103.44827586206897,
103.44827586206897: C4-103.44827586206897,
103.44827586206897: C4-103.44827586206897,
3000`;
const SFX_jared = tune`
236.2204724409449: C4/236.2204724409449 + C5/236.2204724409449,
7322.834645669292`;

const PLAYBACK_MAIN = playTune(MUSIC_main, Infinity);
var PLAYBACK_CONTROLS;
var PLAYBACK_EDITOR;

var LEVEL_TITLE = map``;

const TEXT_A = "A";
const TEXT_B = "B";
const TEXT_C = "C";
const TEXT_D = "D";
const TEXT_E = "E";
const TEXT_F = "F";
const TEXT_G = "G";
const TEXT_H = "H";
const TEXT_I = "I";
const TEXT_J = "J";
const TEXT_K = "K";
const TEXT_L = "L";
const TEXT_M = "M";
const TEXT_N = "N";
const TEXT_O = "O";
const TEXT_P = "P";
const TEXT_Q = "Q";
const TEXT_R = "R";
const TEXT_S = "S";
const TEXT_T = "T";
const TEXT_U = "U";
const TEXT_V = "V";
const TEXT_W = "W";
const TEXT_X = "X";
const TEXT_Y = "Y";
const TEXT_Z = "Z";

const TEXT_EX = "!";
const TEXT_QU = "?";
const TEXT_PE = "[";
const TEXT_DA = "-";

const NUM_0 = "0";
const NUM_1 = "1";
const NUM_2 = "2";
const NUM_3 = "3";
const NUM_4 = "4";
const NUM_5 = "5";
const NUM_6 = "6";
const NUM_7 = "7";
const NUM_8 = "8";
const NUM_9 = "9";

const LOGO_1 = "(";
const LOGO_2 = ")";
const LOGO_3 = "*";
const LOGO_4 = "&";

const player = "#";             // Player Variable

var textLegened = map`
................
................
................
................
................
................
................
................
................
................
................
................
................
................
................
................`;     // This map stores the data for where each piece of text is.
var isUppercase = false;        // Change this to true to have the current character be uppercase.
var isHidden = false;           // Variable to make the press down to start blink
var currentTextPosition = 0;    // Integer that stores the current position in the text_array.
var currentCharacter = 0;      // Current Character Held.
var newInterval;

const VERSION_MAJOR = "0";
const VERSION_MINOR = "0";
const VERSION_PATCH = "5";

setLegend(
  [ player, bitmap`
00..............
00..............
00..............
00..............
00..............
00..............
00..............
00..............
00..............
00..............
00..............
00..............
00..............
00..............
00..............
00..............` ],    // Player text selector position

  [ TEXT_A, bitmap`
................
................
................
......0000......
......0000......
....00....00....
....00....00....
....00000000....
....00000000....
....00....00....
....00....00....
....00....00....
....00....00....
................
................
................`],     // A
  [ TEXT_B, bitmap`
................
................
................
................
....000000......
....000000......
....00....00....
....00....00....
....000000......
....000000......
....00....00....
....00....00....
....000000......
....000000......
................
................`],     // B
  [ TEXT_C, bitmap`
................
................
................
................
......000000....
......000000....
....00..........
....00..........
....00..........
....00..........
....00..........
....00..........
......000000....
......000000....
................
................`],     // C
  [ TEXT_D, bitmap`
................
................
................
................
....000000......
....000000......
....00....00....
....00....00....
....00....00....
....00....00....
....00....00....
....00....00....
....000000......
....000000......
................
................`],     // D
  [ TEXT_E, bitmap`
................
................
................
................
....00000000....
....00000000....
....00..........
....00..........
....000000......
....000000......
....00..........
....00..........
....00000000....
....00000000....
................
................`],     // E
  [ TEXT_F, bitmap`
................
................
................
................
....00000000....
....00000000....
....00..........
....00..........
....000000......
....000000......
....00..........
....00..........
....00..........
....00..........
................
................`],     // F
  [ TEXT_G, bitmap`
................
................
................
................
......000000....
......000000....
....00..........
....00..........
....00..0000....
....00..0000....
....00....00....
....00....00....
......000000....
......000000....
................
................`],     // G
  [ TEXT_H, bitmap`
................
................
................
................
....00....00....
....00....00....
....00....00....
....00....00....
....00000000....
....00000000....
....00....00....
....00....00....
....00....00....
....00....00....
................
................`],     // H
  [ TEXT_I, bitmap`
................
................
................
................
.......00.......
.......00.......
.......00.......
.......00.......
.......00.......
.......00.......
.......00.......
.......00.......
.......00.......
.......00.......
................
................`],     // I
  [ TEXT_J, bitmap`
................
................
..........00....
..........00....
..........00....
..........00....
..........00....
..........00....
..........00....
..........00....
....00....00....
....00....00....
......0000......
......0000......
................
................`],     // J
  [ TEXT_K, bitmap`
................
................
................
................
....00....00....
....00....00....
....00..00......
....00..00......
....0000........
....0000........
....00..00......
....00..00......
....00....00....
....00....00....
................
................`],     // K
  [ TEXT_L, bitmap`
................
................
................
................
....00..........
....00..........
....00..........
....00..........
....00..........
....00..........
....00..........
....00..........
....000000......
....000000......
................
................`],     // L
  [ TEXT_M, bitmap`
................
................
................
................
...00......00...
...00......00...
...0000..0000...
...0000..0000...
...00..00..00...
...00..00..00...
...00......00...
...00......00...
...00......00...
...00......00...
................
................`],     // M
  [ TEXT_N, bitmap`
................
................
................
................
....00....00....
....00....00....
....0000..00....
....0000..00....
....00..0000....
....00..0000....
....00....00....
....00....00....
....00....00....
....00....00....
................
................`],     // N
  [ TEXT_O, bitmap`
................
................
................
................
......0000......
......0000......
....00....00....
....00....00....
....00....00....
....00....00....
....00....00....
....00....00....
......0000......
......0000......
................
................`],     // O
  [ TEXT_P, bitmap`
................
................
................
................
....000000......
....000000......
....00....00....
....00....00....
....000000......
....000000......
....00..........
....00..........
....00..........
....00..........
................
................`],     // P
  [ TEXT_Q, bitmap`
................
................
................
................
......0000......
......0000......
....00....00....
....00....00....
....00....00....
....00....00....
....00..0000....
....00..0000....
......000000....
......000000....
................
................`],     // Q
  [ TEXT_R, bitmap`
................
................
................
................
....000000......
....000000......
....00....00....
....00....00....
....000000......
....000000......
....00..00......
....00..00......
....00....00....
....00....00....
................
................`],     // R
  [ TEXT_S, bitmap`
................
................
................
................
......000000....
......000000....
....00..........
....00..........
......0000......
......0000......
..........00....
..........00....
....000000......
....000000......
................
................`],     // S
  [ TEXT_T, bitmap`
................
................
................
................
.....000000.....
.....000000.....
.......00.......
.......00.......
.......00.......
.......00.......
.......00.......
.......00.......
.......00.......
.......00.......
................
................`],     // T
  [ TEXT_U, bitmap`
................
................
................
................
....00....00....
....00....00....
....00....00....
....00....00....
....00....00....
....00....00....
....00....00....
....00....00....
....00000000....
....00000000....
................
................`],     // U
  [ TEXT_V, bitmap`
................
................
................
................
.....00..00.....
.....00..00.....
.....00..00.....
.....00..00.....
.....00..00.....
.....00..00.....
.....00..00.....
.....00..00.....
.......00.......
.......00.......
................
................`],     // V
  [ TEXT_W, bitmap`
................
................
................
................
...00......00...
...00......00...
...00......00...
...00......00...
...00......00...
...00......00...
...00..00..00...
...00..00..00...
.....00..00.....
.....00..00.....
................
................`],     // W
  [ TEXT_X, bitmap`
................
................
................
................
.....00..00.....
.....00..00.....
.....00..00.....
.....00..00.....
.......00.......
.......00.......
.....00..00.....
.....00..00.....
.....00..00.....
.....00..00.....
................
................`],     // X
  [ TEXT_Y, bitmap`
................
................
................
................
.....00..00.....
.....00..00.....
.....00..00.....
.....00..00.....
.....000000.....
.....000000.....
.......00.......
.......00.......
.......00.......
.......00.......
................
................`],     // Y
  [ TEXT_Z, bitmap`
................
................
................
................
....00000000....
....00000000....
..........00....
..........00....
........00......
........00......
......00........
......00........
....00000000....
....00000000....
................
................`],     // Z
  
  [ TEXT_EX, bitmap`
................
................
.......00.......
.......00.......
.......00.......
.......00.......
.......00.......
.......00.......
.......00.......
.......00.......
................
................
.......00.......
.......00.......
................
................`],    // !
  [ TEXT_QU, bitmap`
................
................
................
................
....0000........
....0000........
........00......
........00......
....0000........
....0000........
................
................
....00..........
....00..........
................
................`],    // ?
  [ TEXT_PE, bitmap`
................
................
................
................
................
................
................
................
................
................
................
................
..00............
..00............
................
................`],    // .
  [ TEXT_DA, bitmap`
................
................
................
................
................
................
................
...0000000000...
...0000000000...
................
................
................
................
................
................
................`],    // -

  [ NUM_0, bitmap`
................
................
................
................
.....000000.....
.....000000.....
...00....0000...
...00....0000...
...00..00..00...
...00..00..00...
...0000....00...
...0000....00...
.....000000.....
.....000000.....
................
................`],      // 0
  [ NUM_1, bitmap`
................
................
.......00.......
.......00.......
.....0000.......
.....0000.......
.......00.......
.......00.......
.......00.......
.......00.......
.......00.......
.......00.......
...0000000000...
...0000000000...
................
................`],      // 1
  [ NUM_2, bitmap`
................
................
................
................
...00000000.....
...00000000.....
...........00...
...........00...
.....000000.....
.....000000.....
...00...........
...00...........
...0000000000...
...0000000000...
................
................`],      // 2
  [ NUM_3, bitmap`
................
................
................
................
.....000000.....
.....000000.....
...00......00...
...00......00...
.......0000.....
.......0000.....
...00......00...
...00......00...
.....000000.....
.....000000.....
................
................`],      // 3
  [ NUM_4, bitmap`
................
................
................
................
.......0000.....
.......0000.....
.....00..00.....
.....00..00.....
...00....00.....
...00....00.....
...0000000000...
...0000000000...
.........00.....
.........00.....
................
................`],      // 4
  [ NUM_5, bitmap`
................
................
................
................
...0000000000...
...0000000000...
...00...........
...00...........
...00000000.....
...00000000.....
...........00...
...........00...
...00000000.....
...00000000.....
................
................`],      // 5
  [ NUM_6, bitmap`
................
................
................
................
.....00000000...
.....00000000...
...00...........
...00...........
...00000000.....
...00000000.....
...00......00...
...00......00...
.....000000.....
.....000000.....
................
................`],      // 6
  [ NUM_7, bitmap`
................
................
................
................
...0000000000...
...0000000000...
...........00...
...........00...
.........00.....
.........00.....
.......00.......
.......00.......
.......00.......
.......00.......
................
................`],      // 7
  [ NUM_8, bitmap`
................
................
................
................
.....000000.....
.....000000.....
...00......00...
...00......00...
.....000000.....
.....000000.....
...00......00...
...00......00...
.....000000.....
.....000000.....
................
................`],      // 8
  [ NUM_9, bitmap`
................
................
................
................
.....000000.....
.....000000.....
...00......00...
...00......00...
.....00000000...
.....00000000...
...........00...
...........00...
.....000000.....
.....000000.....
................
................`],      // 9
)

setSolids([])

var level = 0
const levels = [
  map`
..COLACK..2024..
----------------
................
................
...SPRIG-EDIT...
......----......
.....V0[0[1.....
................
................
...PRESS.DOWN...
................
....TO.START....
................
................
................
................`,                    // Title Screen
  map`
....CONTROLS....
----------------
................
AD.-.MOVE.CURSOR
................
JL.-.CHANGE.....
.....LETTER.....
................
W..-.NEW.LINE...
................
S..-.SPACE......
................
I..-.PLACE.START
................
K..-.DELETE.....
----------------`,                    // Controls
  map`
................
................
................
................
................
................
................
................
................
................
................
................
................
................
................
................`,                    // Text Editor
]

/*
  Set the current selected character for use in the text editor.
*/
function setCharacter() {
  
}

/*
  Loaded at the beginning of the program to display specifically the version.
*/
function createTitleScreen() {
  LEVEL_TITLE = map`..COLACK..2024..
----------------
................
................
...SPRIG-EDIT...
......----......
.....V${VERSION_MAJOR}[${VERSION_MINOR}[${VERSION_PATCH}.....
................
................
...PRESS.DOWN...
................
....TO.START....
................
................
................
................`;
  setMap(LEVEL_TITLE);
}

function titleBlink() {
  if (!isHidden) {
    isHidden = true;
    LEVEL_TITLE = map`..COLACK..2024..
----------------
................
................
...SPRIG-EDIT...
......----......
.....V${VERSION_MAJOR}[${VERSION_MINOR}[${VERSION_PATCH}.....
................
................
................
................
................
................
................
................
................`;
  } else {
    isHidden = false;
    LEVEL_TITLE = map`..COLACK..2024..
----------------
................
................
...SPRIG-EDIT...
......----......
.....V${VERSION_MAJOR}[${VERSION_MINOR}[${VERSION_PATCH}.....
................
................
...PRESS.DOWN...
................
....TO.START....
................
................
................
................`;
  }
  setMap(LEVEL_TITLE);
}

/*
  Executed when the game boots up
*/
function onGameStart() {
  createTitleScreen();

  newInterval = setInterval(titleBlink, 500);
}

/*
  Updates the current legend and rearranges all the text.
*/
function updateTextLegend() {

}

setMap(levels[level])

onInput("j", () => {
  if (currentCharacter == 0) {
    currentCharacter = 39;
  } else {
    currentCharacter--;
  }
});

onInput("l", () => {
  if (currentCharacter == 39) {
    currentCharacter = 0;
  } else {
    currentCharacter++;
  }
});

onInput("s", () => {
  switch (level) {
    case 0:
      level = 1;
      setMap(levels[level]);
      clearInterval(newInterval);
      PLAYBACK_MAIN.end();
      playTune(SFX_start);

      PLAYBACK_CONTROLS = playTune(MUSIC_controls, Infinity);
      break;
    case 1:
      level = 2;
      setMap(levels[level]);
      PLAYBACK_CONTROLS.end();
      playTune(SFX_edit);

      PLAYBACK_EDITOR = playTune(MUSIC_editor, Infinity);
      break;
  }
});

afterInput(() => {
  if (level == 2) {
    updateTextLegend();
    playTune(SFX_jared);
  }
});

onGameStart();
